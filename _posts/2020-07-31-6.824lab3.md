---
layout: post
title: "6.824lab3解题"
date: 2020-07-25 10:30
categories:
    - 6.824
tags:
    - distribution
    - algorithm
---

6.824-2020 
Lab3A: Key/value service without log compaction |
Lab3B: Key/value service with log compaction

## 前言

Lab3的实验主题是基于Raft协议的k/v服务的实现，并且继续Raft论文后半部分关于Snapshot的实现。

本文打算把实验的设计用语言描述，以及总结一下我踩过的坑。

先上实验结果，欢迎讨论。

```text
Test: one client (3A) ...
  ... Passed --  15.1  5  7748  718
Test: many clients (3A) ...
  ... Passed --  15.4  5 24607 3224
Test: unreliable net, many clients (3A) ...
  ... Passed --  16.1  5  8420 1260
Test: concurrent append to same key, unreliable (3A) ...
  ... Passed --   0.9  3   214   52
Test: progress in majority (3A) ...
  ... Passed --   0.3  5    42    2
Test: no progress in minority (3A) ...
  ... Passed --   1.1  5   121    3
Test: completion after heal (3A) ...
  ... Passed --   1.0  5    67    3
Test: partitions, one client (3A) ...
  ... Passed --  22.5  5 12433  510
Test: partitions, many clients (3A) ...
  ... Passed --  23.0  5 65133 2335
Test: restarts, one client (3A) ...
  ... Passed --  19.5  5 15759  713
Test: restarts, many clients (3A) ...
  ... Passed --  19.0  5 55188 3159
Test: unreliable net, restarts, many clients (3A) ...
  ... Passed --  20.5  5  9087 1260
Test: restarts, partitions, many clients (3A) ...
  ... Passed --  26.4  5 48869 1785
Test: unreliable net, restarts, partitions, many clients (3A) ...
  ... Passed --  27.5  5  7009  698
Test: unreliable net, restarts, partitions, many clients, linearizability checks (3A) ...
  ... Passed --  25.3  7 17666 1276
Test: InstallSnapshot RPC (3B) ...
  ... Passed --   4.2  3  3291   63
Test: snapshot size is reasonable (3B) ...
  ... Passed --  17.3  3  5666  800
Test: restarts, snapshots, one client (3B) ...
  ... Passed --  19.8  5 19744  708
Test: restarts, snapshots, many clients (3B) ...
  ... Passed --  20.0  5 92609 10392
Test: unreliable net, snapshots, many clients (3B) ...
  ... Passed --  16.2  5  8592 1270
Test: unreliable net, restarts, snapshots, many clients (3B) ...
  ... Passed --  19.8  5  8894 1247
Test: unreliable net, restarts, partitions, snapshots, many clients (3B) ...
  ... Passed --  27.8  5  7799  899
Test: unreliable net, restarts, partitions, snapshots, many clients, linearizability checks (3B) ...
  ... Passed --  25.3  7 20073 1563
PASS
ok  	6.824/src/kvraft	384.614s

```

## 代码设计


